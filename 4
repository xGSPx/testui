local Library = {}
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")

if CoreGui:FindFirstChild("GeminiLib") then CoreGui.GeminiLib:Destroy() end

local IsInteracting = false

local function Dragify(Frame)
    local dragToggle, dragStart, startPos, dragInput
    Frame.InputBegan:Connect(function(input)
        if not IsInteracting and (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch) then
            dragToggle = true; dragStart = input.Position; startPos = Frame.Position
            input.Changed:Connect(function() if input.UserInputState == Enum.UserInputState.End then dragToggle = false end end)
        end
    end)
    Frame.InputChanged:Connect(function(input) if (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then dragInput = input end end)
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragToggle and not IsInteracting then
            local delta = input.Position - dragStart
            Frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
end

function Library:CreateWindow(Settings)
    local Main = Instance.new("ScreenGui", CoreGui); Main.Name = "GeminiLib"
    
    local MobileBtn = Instance.new("TextButton", Main)
    MobileBtn.Size = UDim2.new(0, 50, 0, 50); MobileBtn.Position = UDim2.new(0, 20, 0, 20); MobileBtn.BackgroundColor3 = Color3.fromRGB(15, 15, 15); MobileBtn.Text = "G"; MobileBtn.TextColor3 = Color3.fromRGB(180, 0, 255); MobileBtn.Font = Enum.Font.GothamBold; MobileBtn.TextSize = 24
    Instance.new("UICorner", MobileBtn).CornerRadius = UDim.new(1, 0); Dragify(MobileBtn)

    local MainFrame = Instance.new("Frame", Main)
    MainFrame.BackgroundColor3 = Color3.fromRGB(10, 10, 10); MainFrame.Size = UDim2.new(0, 580, 0, 460); MainFrame.Position = UDim2.new(0.5, -290, 0.5, -230)
    Instance.new("UICorner", MainFrame); Dragify(MainFrame)
    MobileBtn.MouseButton1Click:Connect(function() MainFrame.Visible = not MainFrame.Visible end)

    local Title = Instance.new("TextLabel", MainFrame)
    Title.Size = UDim2.new(1, -20, 0, 45); Title.Position = UDim2.new(0, 15, 0, 5); Title.Text = Settings.Name:upper(); Title.TextColor3 = Color3.fromRGB(180, 0, 255); Title.Font = Enum.Font.GothamBold; Title.TextSize = 18; Title.BackgroundTransparency = 1; Title.TextXAlignment = Enum.TextXAlignment.Left

    local Sidebar = Instance.new("Frame", MainFrame); Sidebar.Size = UDim2.new(0, 150, 1, -70); Sidebar.Position = UDim2.new(0, 10, 0, 55); Sidebar.BackgroundColor3 = Color3.fromRGB(14, 14, 14); Instance.new("UICorner", Sidebar)
    local SidebarList = Instance.new("UIListLayout", Sidebar); SidebarList.Padding = UDim.new(0, 5); SidebarList.HorizontalAlignment = Enum.HorizontalAlignment.Center

    local Container = Instance.new("Frame", MainFrame); Container.Size = UDim2.new(1, -185, 1, -70); Container.Position = UDim2.new(0, 170, 0, 55); Container.BackgroundTransparency = 1

    local Tabs = {}
    local FirstTab = true
    function Tabs:CreateTab(name)
        local Page = Instance.new("ScrollingFrame", Container); Page.Size = UDim2.new(1, 0, 1, 0); Page.BackgroundTransparency = 1; Page.Visible = false; Page.ScrollBarThickness = 2; Page.ScrollBarImageColor3 = Color3.fromRGB(180, 0, 255); Page.AutomaticCanvasSize = Enum.AutomaticSize.Y
        local PageList = Instance.new("UIListLayout", Page); PageList.Padding = UDim.new(0, 10); PageList.HorizontalAlignment = Enum.HorizontalAlignment.Center

        local TabBtn = Instance.new("TextButton", Sidebar); TabBtn.Size = UDim2.new(1, -12, 0, 40); TabBtn.Text = name; TabBtn.TextColor3 = Color3.fromRGB(160, 160, 160); TabBtn.BackgroundColor3 = Color3.fromRGB(20, 20, 20); Instance.new("UICorner", TabBtn)
        
        if FirstTab then Page.Visible = true; TabBtn.TextColor3 = Color3.fromRGB(255,255,255); FirstTab = false end

        TabBtn.MouseButton1Click:Connect(function()
            for _, v in pairs(Container:GetChildren()) do if v:IsA("ScrollingFrame") then v.Visible = false end end
            for _, v in pairs(Sidebar:GetChildren()) do if v:IsA("TextButton") then v.TextColor3 = Color3.fromRGB(160, 160, 160) end end
            Page.Visible = true; TabBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
        end)

        local Elements = {}
        local order = 0
        local function getOrder() order = order + 1 return order end

        function Elements:CreateSection(text)
            local S = Instance.new("TextLabel", Page); S.Size = UDim2.new(1, -10, 0, 35); S.Text = "  " .. text:upper(); S.TextColor3 = Color3.fromRGB(180, 0, 255); S.Font = Enum.Font.GothamBold; S.BackgroundTransparency = 1; S.TextXAlignment = Enum.TextXAlignment.Left; S.LayoutOrder = getOrder(); S.TextSize = 15
        end

        function Elements:CreateDivider()
            local D = Instance.new("Frame", Page); D.Size = UDim2.new(1, -20, 0, 2); D.BackgroundColor3 = Color3.fromRGB(40, 40, 40); D.BorderSizePixel = 0; D.LayoutOrder = getOrder()
        end

        function Elements:CreateToggle(cfg)
            local T = Instance.new("TextButton", Page); T.Size = UDim2.new(1, -10, 0, 40); T.BackgroundColor3 = Color3.fromRGB(18, 18, 18); T.Text = "  " .. cfg.Name; T.TextColor3 = Color3.fromRGB(255, 255, 255); T.TextXAlignment = Enum.TextXAlignment.Left; T.LayoutOrder = getOrder(); Instance.new("UICorner", T)
            local s = false
            T.MouseButton1Click:Connect(function() s = not s; T.TextColor3 = s and Color3.fromRGB(180, 0, 255) or Color3.fromRGB(255, 255, 255); cfg.Callback(s) end)
        end

        function Elements:CreateSlider(cfg)
            local S = Instance.new("Frame", Page); S.Size = UDim2.new(1, -10, 0, 50); S.BackgroundColor3 = Color3.fromRGB(18, 18, 18); S.LayoutOrder = getOrder(); Instance.new("UICorner", S)
            local L = Instance.new("TextLabel", S); L.Size = UDim2.new(1, -70, 0, 30); L.BackgroundTransparency = 1; L.Text = "  " .. cfg.Name; L.TextColor3 = Color3.fromRGB(255,255,255); L.TextXAlignment = Enum.TextXAlignment.Left; L.Font = Enum.Font.Gotham; L.TextSize = 14
            local V = Instance.new("TextLabel", S); V.Size = UDim2.new(0, 50, 0, 30); V.Position = UDim2.new(1, -60, 0, 0); V.Text = tostring(cfg.Range[1]); V.TextColor3 = Color3.fromRGB(180,0,255); V.BackgroundTransparency = 1; V.TextSize = 14
            local Bar = Instance.new("Frame", S); Bar.Size = UDim2.new(1, -20, 0, 4); Bar.Position = UDim2.new(0, 10, 0, 38); Bar.BackgroundColor3 = Color3.fromRGB(35, 35, 35); Bar.BorderSizePixel = 0
            local Fill = Instance.new("Frame", Bar); Fill.Size = UDim2.new(0, 0, 1, 0); Fill.BackgroundColor3 = Color3.fromRGB(180, 0, 255); Fill.BorderSizePixel = 0
            Bar.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    IsInteracting = true
                    local move; move = UserInputService.InputChanged:Connect(function(i)
                        if i.UserInputType == Enum.UserInputType.MouseMovement then
                            local perc = math.clamp((i.Position.X - Bar.AbsolutePosition.X) / Bar.AbsoluteSize.X, 0, 1)
                            Fill.Size = UDim2.new(perc, 0, 1, 0)
                            local val = math.floor(cfg.Range[1] + (perc * (cfg.Range[2] - cfg.Range[1])))
                            V.Text = tostring(val); cfg.Callback(val)
                        end
                    end)
                    UserInputService.InputEnded:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 then move:Disconnect(); IsInteracting = false end end)
                end
            end)
        end

        function Elements:CreateDropdown(cfg)
            local D = Instance.new("Frame", Page); D.Size = UDim2.new(1, -10, 0, 40); D.BackgroundColor3 = Color3.fromRGB(18, 18, 18); D.ClipsDescendants = true; D.LayoutOrder = getOrder(); Instance.new("UICorner", D)
            local Lbl = Instance.new("TextLabel", D); Lbl.Size = UDim2.new(1, -45, 0, 40); Lbl.Text = "  " .. cfg.Name; Lbl.TextColor3 = Color3.fromRGB(255,255,255); Lbl.BackgroundTransparency = 1; Lbl.TextXAlignment = Enum.TextXAlignment.Left; Lbl.Font = Enum.Font.Gotham; Lbl.TextSize = 14
            local List = Instance.new("ScrollingFrame", D); List.Size = UDim2.new(1, 0, 0, 120); List.Position = UDim2.new(0, 0, 0, 40); List.BackgroundTransparency = 1; List.AutomaticCanvasSize = Enum.AutomaticSize.Y; List.ScrollBarThickness = 2
            Instance.new("UIListLayout", List)
            local btn = Instance.new("TextButton", D); btn.Size = UDim2.new(0, 30, 0, 30); btn.Position = UDim2.new(1, -35, 0, 5); btn.Text = "+"; btn.TextColor3 = Color3.fromRGB(180, 0, 255); btn.BackgroundColor3 = Color3.fromRGB(25, 25, 25); Instance.new("UICorner", btn)
            local open = false
            btn.MouseButton1Click:Connect(function()
                open = not open; btn.Text = open and "-" or "+"
                TweenService:Create(D, TweenInfo.new(0.3), {Size = open and UDim2.new(1, -10, 0, 160) or UDim2.new(1, -10, 0, 40)}):Play()
            end)
            for _, opt in pairs(cfg.Options) do
                local o = Instance.new("TextButton", List); o.Size = UDim2.new(1, 0, 0, 30); o.Text = opt; o.BackgroundColor3 = Color3.fromRGB(22, 22, 22); o.TextColor3 = Color3.fromRGB(200, 200, 200); o.Font = Enum.Font.Gotham; o.TextSize = 13
                o.MouseButton1Click:Connect(function() cfg.Callback(opt); Lbl.Text = "  " .. cfg.Name .. " [" .. opt .. "]"; open = false; D.Size = UDim2.new(1, -10, 0, 40); btn.Text = "+" end)
            end
        end

        function Elements:CreateInput(cfg)
            local I = Instance.new("Frame", Page); I.Size = UDim2.new(1, -10, 0, 60); I.BackgroundColor3 = Color3.fromRGB(18, 18, 18); I.LayoutOrder = getOrder(); Instance.new("UICorner", I)
            local Tl = Instance.new("TextLabel", I); Tl.Size = UDim2.new(1, 0, 0, 25); Tl.Text = "  " .. cfg.Name; Tl.BackgroundTransparency = 1; Tl.TextColor3 = Color3.fromRGB(255,255,255); Tl.TextXAlignment = Enum.TextXAlignment.Left; Tl.Font = Enum.Font.Gotham; Tl.TextSize = 14
            local Box = Instance.new("TextBox", I); Box.Size = UDim2.new(1, -20, 0, 28); Box.Position = UDim2.new(0, 10, 0, 26); Box.BackgroundColor3 = Color3.fromRGB(25, 25, 25); Box.PlaceholderText = cfg.Placeholder; Box.Text = ""; Box.TextColor3 = Color3.fromRGB(180,0,255); Instance.new("UICorner", Box)
            Box.FocusLost:Connect(function() cfg.Callback(Box.Text) end)
        end

        function Elements:CreateButton(cfg)
            local B = Instance.new("TextButton", Page); B.Size = UDim2.new(1, -10, 0, 40); B.BackgroundColor3 = Color3.fromRGB(18, 18, 18); B.Text = "  " .. cfg.Name; B.TextColor3 = Color3.fromRGB(255, 255, 255); B.TextXAlignment = Enum.TextXAlignment.Left; B.LayoutOrder = getOrder(); Instance.new("UICorner", B)
            B.MouseButton1Click:Connect(cfg.Callback)
        end

        return Elements
    end
    return Tabs
end

function Library:Destroy() if CoreGui:FindFirstChild("GeminiLib") then CoreGui.GeminiLib:Destroy() end end

return Library
