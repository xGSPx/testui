-- // GEMINI UI LIBRARY v12.0 (PROTECTED LOADER + DRAGGABLE TOGGLE + SCROLLING DROPDOWNS)
local Library = {}
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")

if CoreGui:FindFirstChild("GeminiLib") then CoreGui.GeminiLib:Destroy() end

local IsInteracting = false

-- // Icon Database
local function GetIcon(name)
    local icons = {
        ["sword"] = "rbxassetid://10723306472",
        ["eye"] = "rbxassetid://10723343385",
        ["settings"] = "rbxassetid://10723350052",
        ["info"] = "rbxassetid://10723346959"
    }
    return icons[name:lower()] or "rbxassetid://4483362458"
end

-- // Universal Drag Function
local function Dragify(Frame)
    local dragToggle, dragStart, startPos, dragInput
    Frame.InputBegan:Connect(function(input)
        if not IsInteracting and (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch) then
            dragToggle = true; dragStart = input.Position; startPos = Frame.Position
            input.Changed:Connect(function() if input.UserInputState == Enum.UserInputState.End then dragToggle = false end end)
        end
    end)
    Frame.InputChanged:Connect(function(input) if (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then dragInput = input end end)
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragToggle and not IsInteracting then
            local delta = input.Position - dragStart
            Frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
end

-- // Notification System
function Library:Notify(cfg)
    local NoteMain = CoreGui:FindFirstChild("GeminiLib") or Instance.new("ScreenGui", CoreGui)
    NoteMain.Name = "GeminiLib"
    local Note = Instance.new("Frame", NoteMain)
    Note.Size = UDim2.new(0, 280, 0, 75); Note.Position = UDim2.new(1, 20, 1, -100); Note.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
    Instance.new("UICorner", Note); Instance.new("UIStroke", Note).Color = Color3.fromRGB(180, 0, 255)
    local T = Instance.new("TextLabel", Note); T.Size = UDim2.new(1, -20, 0, 30); T.Position = UDim2.new(0, 15, 0, 8); T.Text = cfg.Title; T.TextColor3 = Color3.fromRGB(180, 0, 255); T.Font = Enum.Font.GothamBold; T.BackgroundTransparency = 1; T.TextXAlignment = Enum.TextXAlignment.Left; T.TextSize = 16
    local C = Instance.new("TextLabel", Note); C.Size = UDim2.new(1, -20, 0, 25); C.Position = UDim2.new(0, 15, 0, 38); C.Text = cfg.Content; C.TextColor3 = Color3.fromRGB(200, 200, 200); C.Font = Enum.Font.Gotham; C.BackgroundTransparency = 1; C.TextXAlignment = Enum.TextXAlignment.Left; C.TextSize = 14
    Note:TweenPosition(UDim2.new(1, -300, 1, -100), "Out", "Quint", 0.6)
    task.wait(cfg.Duration or 3); Note:TweenPosition(UDim2.new(1, 20, 1, -100), "In", "Quint", 0.6); task.delay(0.6, function() Note:Destroy() end)
end

function Library:CreateWindow(Settings)
    Library:Notify({Title = Settings.Name, Content = "Checking license and loading assets...", Duration = 3})
    task.wait(1)

    local Main = Instance.new("ScreenGui", CoreGui); Main.Name = "GeminiLib"
    
    -- // Draggable Mobile Button
    local MobileBtn = Instance.new("TextButton", Main)
    MobileBtn.Size = UDim2.new(0, 50, 0, 50); MobileBtn.Position = UDim2.new(0, 20, 0, 20); MobileBtn.BackgroundColor3 = Color3.fromRGB(15, 15, 15); MobileBtn.Text = "G"; MobileBtn.TextColor3 = Color3.fromRGB(180, 0, 255); MobileBtn.Font = Enum.Font.GothamBold; MobileBtn.TextSize = 24
    Instance.new("UICorner", MobileBtn).CornerRadius = UDim.new(1, 0); Dragify(MobileBtn)

    local MainFrame = Instance.new("Frame", Main)
    MainFrame.BackgroundColor3 = Color3.fromRGB(10, 10, 10); MainFrame.Size = UDim2.new(0, 580, 0, 460); MainFrame.Position = UDim2.new(0.5, -290, 0.5, -230)
    Instance.new("UICorner", MainFrame); Dragify(MainFrame)
    MobileBtn.MouseButton1Click:Connect(function() MainFrame.Visible = not MainFrame.Visible end)

    local Title = Instance.new("TextLabel", MainFrame)
    Title.Size = UDim2.new(1, -20, 0, 45); Title.Position = UDim2.new(0, 15, 0, 5); Title.Text = Settings.Name:upper(); Title.TextColor3 = Color3.fromRGB(180, 0, 255); Title.Font = Enum.Font.GothamBold; Title.TextSize = 18; Title.BackgroundTransparency = 1; Title.TextXAlignment = Enum.TextXAlignment.Left

    local Sidebar = Instance.new("Frame", MainFrame); Sidebar.Size = UDim2.new(0, 150, 1, -70); Sidebar.Position = UDim2.new(0, 10, 0, 55); Sidebar.BackgroundColor3 = Color3.fromRGB(14, 14, 14); Instance.new("UICorner", Sidebar)
    local SidebarList = Instance.new("UIListLayout", Sidebar); SidebarList.SortOrder = Enum.SortOrder.LayoutOrder; SidebarList.Padding = UDim.new(0, 5); SidebarList.HorizontalAlignment = Enum.HorizontalAlignment.Center

    local Container = Instance.new("Frame", MainFrame); Container.Size = UDim2.new(1, -185, 1, -70); Container.Position = UDim2.new(0, 170, 0, 55); Container.BackgroundTransparency = 1

    function Library:Destroy() Main:Destroy() end

    local Tabs = {}
    function Tabs:CreateTab(name, icon)
        local Page = Instance.new("ScrollingFrame", Container); Page.Size = UDim2.new(1, 0, 1, 0); Page.BackgroundTransparency = 1; Page.Visible = false; Page.ScrollBarThickness = 2; Page.ScrollBarImageColor3 = Color3.fromRGB(180, 0, 255); Page.AutomaticCanvasSize = Enum.AutomaticSize.Y
        local PageList = Instance.new("UIListLayout", Page); PageList.SortOrder = Enum.SortOrder.LayoutOrder; PageList.Padding = UDim.new(0, 10); PageList.HorizontalAlignment = Enum.HorizontalAlignment.Center

        local TabBtn = Instance.new("TextButton", Sidebar); TabBtn.Size = UDim2.new(1, -12, 0, 40); TabBtn.Text = "         " .. name; TabBtn.TextColor3 = Color3.fromRGB(160, 160, 160); TabBtn.BackgroundColor3 = Color3.fromRGB(20, 20, 20); Instance.new("UICorner", TabBtn); TabBtn.TextXAlignment = Enum.TextXAlignment.Left; TabBtn.Font = Enum.Font.GothamMedium; TabBtn.TextSize = 14
        if icon then
            local I = Instance.new("ImageLabel", TabBtn); I.Size = UDim2.new(0, 20, 0, 20); I.Position = UDim2.new(0, 10, 0.5, -10); I.BackgroundTransparency = 1; I.Image = GetIcon(icon); I.ImageColor3 = Color3.fromRGB(180,0,255)
        end

        TabBtn.MouseButton1Click:Connect(function()
            for _, v in pairs(Container:GetChildren()) do if v:IsA("ScrollingFrame") then v.Visible = false end end
            Page.Visible = true
        end)
        if not FirstPage then Page.Visible = true end

        local Elements = {}
        local OrderCount = 0
        local function NextOrder() OrderCount = OrderCount + 1 return OrderCount end

        function Elements:CreateDropdown(cfg)
            local D = Instance.new("Frame", Page); D.Size = UDim2.new(1, -10, 0, 40); D.BackgroundColor3 = Color3.fromRGB(18, 18, 18); D.ClipsDescendants = true; D.LayoutOrder = NextOrder(); Instance.new("UICorner", D)
            local Lbl = Instance.new("TextLabel", D); Lbl.Size = UDim2.new(1, -45, 0, 40); Lbl.Text = "  " .. cfg.Name; Lbl.TextColor3 = Color3.fromRGB(255,255,255); Lbl.BackgroundTransparency = 1; Lbl.TextXAlignment = Enum.TextXAlignment.Left; Lbl.Font = Enum.Font.Gotham; Lbl.TextSize = 14
            local SideBtn = Instance.new("TextButton", D); SideBtn.Size = UDim2.new(0, 30, 0, 30); SideBtn.Position = UDim2.new(1, -35, 0, 5); SideBtn.BackgroundColor3 = Color3.fromRGB(25, 25, 25); SideBtn.Text = "+"; SideBtn.TextColor3 = Color3.fromRGB(180, 0, 255); Instance.new("UICorner", SideBtn)
            
            local ListScroll = Instance.new("ScrollingFrame", D); ListScroll.Size = UDim2.new(1, 0, 0, 150); ListScroll.Position = UDim2.new(0,0,0,40); ListScroll.BackgroundTransparency = 1; ListScroll.ScrollBarThickness = 2; ListScroll.ScrollBarImageColor3 = Color3.fromRGB(180, 0, 255); ListScroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
            local ListLayout = Instance.new("UIListLayout", ListScroll)
            
            local open = false
            SideBtn.MouseButton1Click:Connect(function()
                open = not open; SideBtn.Text = open and "-" or "+"; 
                local targetHeight = open and math.min(40 + (#cfg.Options * 30), 200) or 40
                TweenService:Create(D, TweenInfo.new(0.3, Enum.EasingStyle.Quart), {Size = UDim2.new(1,-10,0, targetHeight)}):Play()
            end)

            for _, opt in pairs(cfg.Options) do
                local o = Instance.new("TextButton", ListScroll); o.Size = UDim2.new(1,0,0,30); o.Text = opt; o.BackgroundColor3 = Color3.fromRGB(22,22,22); o.TextColor3 = Color3.fromRGB(200,200,200); o.BorderSizePixel = 0; o.Font = Enum.Font.Gotham; o.TextSize = 13
                o.MouseButton1Click:Connect(function() cfg.Callback(opt); Lbl.Text = "  " .. cfg.Name .. " [" .. opt .. "]"; open = false; D.Size = UDim2.new(1,-10,0,40); SideBtn.Text = "+" end)
            end
        end

        function Elements:CreateSection(text)
            local S = Instance.new("TextLabel", Page); S.Size = UDim2.new(1, -10, 0, 35); S.Text = "  " .. text:upper(); S.TextColor3 = Color3.fromRGB(180, 0, 255); S.Font = Enum.Font.GothamBold; S.BackgroundTransparency = 1; S.TextXAlignment = Enum.TextXAlignment.Left; S.LayoutOrder = NextOrder(); S.TextSize = 15
        end

        function Elements:CreateButton(cfg)
            local B = Instance.new("TextButton", Page); B.Size = UDim2.new(1, -10, 0, 40); B.BackgroundColor3 = Color3.fromRGB(18, 18, 18); B.Text = "  " .. cfg.Name; B.TextColor3 = Color3.fromRGB(255, 255, 255); B.TextXAlignment = Enum.TextXAlignment.Left; B.LayoutOrder = NextOrder(); Instance.new("UICorner", B)
            B.MouseButton1Click:Connect(cfg.Callback)
        end

        return Elements
    end
    return Tabs
end

return Library
